<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Phân cụm khách hàng (K=6)</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body class="bg-light">

  <div class="container-fluid mt-3">
    <div class="row">
      
      
      <div class="col-md-5">
        <div class="card shadow-sm mb-3">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Chọn cụm hiển thị</h5>
          </div>
          <div class="card-body">
            <form method="get" action="/">
              <select class="form-select" name="cluster" onchange="this.form.submit()">
                {% for cluster_num in clusters.keys() %}
                  <option value="{{ cluster_num }}" {% if cluster_num == selected_cluster %}selected{% endif %}>
                    Cụm {{ cluster_num }}
                  </option>
                {% endfor %}
              </select>
            </form>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">Danh sách khách hàng - Cụm {{ selected_cluster }}</h5>
          </div>
          <div class="card-body" style="max-height: 70vh; overflow-y: auto;">
            <table class="table table-bordered table-sm align-middle">
              <thead class="table-dark sticky-top">
                <tr>
                  {% for col in cluster_df.columns %}
                    <th>{{ col }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for row in cluster_df.itertuples(index=False) %}
                  <tr>
                    {% for value in row %}
                      <td>{{ value }}</td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-md-7">
        <div class="card shadow-sm">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">Biểu đồ 3D - Phân cụm khách hàng (K=6)</h5>
          </div>
          <div class="card-body">
            <div id="clusterPlot" style="height: 80vh;"></div>
            <script>
              const fig = {{ fig_json | safe }};
              Plotly.newPlot('clusterPlot', fig.data, fig.layout);
            </script>
          </div>
        </div>
      </div>

    </div>
  </div>

</body>
</html>
